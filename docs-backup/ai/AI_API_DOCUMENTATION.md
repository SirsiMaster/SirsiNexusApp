# SirsiNexus AI API Documentation

## Overview

The SirsiNexus AI API provides enterprise-grade artificial intelligence capabilities for cloud infrastructure management, optimization, and automation. This API integrates with leading AI providers (OpenAI GPT-4 and Anthropic Claude-3.5-Sonnet) to deliver production-ready infrastructure templates and cost optimization recommendations.

## Base URL

```
http://localhost:3000/api
```

## Authentication

All AI API endpoints require proper authentication. Include your JWT token in the Authorization header:

```
Authorization: Bearer <your-jwt-token>
```

## Endpoints

### 1. AI Health Check

Check the status and availability of AI services.

**Endpoint:** `GET /ai/health`

**Response:**
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "services": {
      "openai": {
        "available": true,
        "provider": "OpenAI GPT-4",
        "mode": "real"
      },
      "claude": {
        "available": true,
        "provider": "Anthropic Claude-3.5-Sonnet",
        "mode": "real"
      },
      "infrastructure_generator": {
        "available": true,
        "provider": "SirsiNexus AI Infrastructure",
        "mode": "real"
      },
      "optimization_engine": {
        "available": true,
        "provider": "SirsiNexus AI Optimization",
        "mode": "real"
      }
    },
    "version": "0.5.0-alpha"
  },
  "error": null,
  "timestamp": "2025-01-07T20:30:00.000Z"
}
```

### 2. Generate Infrastructure Template

Generate production-ready infrastructure templates using AI.

**Endpoint:** `POST /ai/infrastructure/generate`

**Request Body:**
```json
{
  "description": "E-commerce platform with high availability and auto-scaling",
  "cloud_provider": "AWS",
  "ai_provider": "OpenAI",
  "requirements": {
    "budget_limit": 5000.0,
    "performance_tier": "Premium",
    "security_level": "Enhanced",
    "compliance_requirements": ["SOC2", "PCI-DSS"],
    "scaling_requirements": {
      "min_instances": 2,
      "max_instances": 10,
      "auto_scaling": true,
      "load_balancing": true
    }
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "template": "# AWS Infrastructure Template - Generated by SirsiNexus AI\n# Description: E-commerce platform with high availability and auto-scaling\n\nterraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.0\"\n    }\n  }\n}\n\nprovider \"aws\" {\n  region = \"us-west-2\"\n}\n\n# VPC Configuration\nresource \"aws_vpc\" \"main\" {\n  cidr_block           = \"10.0.0.0/16\"\n  enable_dns_hostnames = true\n  enable_dns_support   = true\n\n  tags = {\n    Name        = \"ecommerce-vpc\"\n    Environment = \"production\"\n    ManagedBy   = \"SirsiNexus\"\n  }\n}\n\n# Internet Gateway\nresource \"aws_internet_gateway\" \"main\" {\n  vpc_id = aws_vpc.main.id\n\n  tags = {\n    Name      = \"ecommerce-igw\"\n    ManagedBy = \"SirsiNexus\"\n  }\n}\n\n# Auto Scaling Group\nresource \"aws_autoscaling_group\" \"web\" {\n  name                = \"ecommerce-asg\"\n  vpc_zone_identifier = [aws_subnet.public.id]\n  target_group_arns   = [aws_lb_target_group.web.arn]\n  health_check_type   = \"ELB\"\n  min_size            = 2\n  max_size            = 10\n  desired_capacity    = 3\n\n  launch_template {\n    id      = aws_launch_template.web.id\n    version = \"$Latest\"\n  }\n\n  tag {\n    key                 = \"Name\"\n    value               = \"ecommerce-web\"\n    propagate_at_launch = true\n  }\n}",
    "template_type": "Terraform",
    "estimated_cost": 4250.0,
    "security_recommendations": [
      "Enable WAF (Web Application Firewall)",
      "Implement network segmentation",
      "Enable encryption at rest",
      "Use dedicated security groups per service"
    ],
    "optimization_suggestions": [
      "Consider using auto-scaling for variable workloads",
      "Implement CloudWatch monitoring for cost optimization",
      "Use reserved instances for predictable workloads",
      "Enable resource tagging for cost allocation"
    ],
    "deployment_instructions": [
      "1. Save the template as main.tf",
      "2. Run 'terraform init' to initialize",
      "3. Run 'terraform plan' to preview changes",
      "4. Run 'terraform apply' to deploy",
      "5. Run 'terraform destroy' to clean up"
    ],
    "ai_provider_used": "OpenAI",
    "confidence_score": 0.92
  },
  "error": null,
  "timestamp": "2025-01-07T20:30:00.000Z"
}
```

### 3. Optimize Infrastructure

Analyze existing infrastructure and provide AI-powered optimization recommendations.

**Endpoint:** `POST /ai/optimization/analyze`

**Request Body:**
```json
{
  "infrastructure_data": {
    "cloud_provider": "AWS",
    "regions": ["us-west-2", "us-east-1"],
    "resources": [
      {
        "resource_type": "EC2",
        "instance_type": "t3.large",
        "count": 5,
        "utilization": 0.35,
        "cost_per_hour": 0.0832,
        "tags": {
          "Environment": "production",
          "Application": "web-server"
        }
      },
      {
        "resource_type": "RDS",
        "instance_type": "db.r5.xlarge",
        "count": 1,
        "utilization": 0.65,
        "cost_per_hour": 0.504,
        "tags": {
          "Environment": "production",
          "Application": "database"
        }
      }
    ],
    "usage_patterns": {
      "cpu_utilization": [0.35, 0.32, 0.38, 0.33, 0.36],
      "memory_utilization": [0.45, 0.42, 0.48, 0.44, 0.46],
      "network_io": [1200, 1150, 1300, 1180, 1220],
      "storage_io": [800, 780, 850, 790, 820],
      "time_series_data": [
        {
          "timestamp": 1641859200,
          "cpu": 0.35,
          "memory": 0.45,
          "network": 1200
        }
      ]
    }
  },
  "performance_metrics": {
    "response_time_ms": 150.0,
    "throughput_rps": 1250.0,
    "error_rate": 0.001,
    "availability": 0.9995
  },
  "cost_constraints": {
    "monthly_budget": 8000.0,
    "max_cost_increase": 10.0,
    "cost_optimization_priority": "Balanced"
  },
  "optimization_goals": [
    "CostReduction",
    "PerformanceImprovement",
    "Reliability"
  ],
  "ai_provider": "Claude3_5Sonnet"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "recommendations": [
      {
        "category": "InstanceSizing",
        "description": "Right-size over-provisioned instances based on low CPU utilization",
        "impact": "High",
        "implementation_effort": "Medium",
        "cost_savings_annual": 18720.0,
        "risk_level": "Low",
        "specific_actions": [
          "Analyze CPU utilization patterns over 30 days",
          "Identify instances with <30% CPU utilization",
          "Downsize to appropriate instance types",
          "Monitor performance after downsizing"
        ]
      },
      {
        "category": "AutoScaling",
        "description": "Implement auto-scaling to handle variable workloads efficiently",
        "impact": "High",
        "implementation_effort": "Medium",
        "cost_savings_annual": 11232.0,
        "risk_level": "Medium",
        "specific_actions": [
          "Set up CloudWatch alarms for CPU and memory",
          "Configure auto-scaling policies",
          "Test scaling behavior under load",
          "Fine-tune scaling thresholds"
        ]
      },
      {
        "category": "ReservedInstances",
        "description": "Purchase reserved instances for predictable workloads",
        "impact": "High",
        "implementation_effort": "Low",
        "cost_savings_annual": 22464.0,
        "risk_level": "Low",
        "specific_actions": [
          "Analyze usage patterns for consistent workloads",
          "Calculate ROI for 1-year and 3-year reservations",
          "Purchase appropriate reserved instances",
          "Monitor and optimize reservations quarterly"
        ]
      }
    ],
    "predicted_cost_savings": 52416.0,
    "predicted_performance_impact": {
      "response_time_change": -18.0,
      "throughput_change": 25.0,
      "availability_change": 3.0
    },
    "implementation_plan": {
      "phases": [
        {
          "phase_number": 1,
          "description": "Assessment and Planning",
          "actions": [
            "Complete infrastructure audit",
            "Validate cost and performance baselines",
            "Identify quick wins"
          ],
          "duration_weeks": 2,
          "dependencies": []
        },
        {
          "phase_number": 2,
          "description": "Low-Risk Optimizations",
          "actions": [
            "Implement reserved instance purchases",
            "Enable cost allocation tags",
            "Configure monitoring dashboards"
          ],
          "duration_weeks": 3,
          "dependencies": [1]
        }
      ],
      "estimated_timeline_weeks": 12,
      "rollback_strategy": "Each phase includes rollback procedures with automated monitoring to detect performance degradation"
    },
    "confidence_score": 0.94,
    "ai_provider_used": "Claude3_5Sonnet"
  },
  "error": null,
  "timestamp": "2025-01-07T20:30:00.000Z"
}
```

### 4. AI Capabilities

Get information about supported AI capabilities and providers.

**Endpoint:** `GET /ai/capabilities`

**Response:**
```json
{
  "success": true,
  "data": {
    "infrastructure_generation": {
      "supported_cloud_providers": [
        "AWS",
        "Azure",
        "GCP",
        "Kubernetes",
        "IBM Cloud",
        "Oracle Cloud",
        "Alibaba Cloud"
      ],
      "template_formats": [
        "Terraform",
        "Bicep",
        "YAML",
        "CloudFormation"
      ],
      "ai_models": [
        "GPT-4 Turbo",
        "Claude-3.5-Sonnet"
      ],
      "features": [
        "Production-ready templates",
        "Security best practices",
        "Cost optimization",
        "Auto-scaling configuration",
        "Compliance recommendations"
      ]
    },
    "optimization": {
      "optimization_goals": [
        "Cost Reduction",
        "Performance Improvement",
        "Reliability Enhancement",
        "Security Hardening",
        "Sustainability"
      ],
      "recommendation_categories": [
        "Instance Sizing",
        "Auto Scaling",
        "Reserved Instances",
        "Spot Instances",
        "Storage Optimization",
        "Network Optimization",
        "Architectural Changes"
      ],
      "analytics_features": [
        "Usage Pattern Analysis",
        "Cost Prediction",
        "Performance Impact Assessment",
        "Risk Analysis",
        "Implementation Planning"
      ],
      "cost_prediction": true
    },
    "supported_providers": {
      "cloud_providers": [
        "AWS",
        "Microsoft Azure",
        "Google Cloud Platform",
        "Kubernetes",
        "IBM Cloud",
        "Oracle Cloud",
        "Alibaba Cloud"
      ],
      "ai_providers": [
        "OpenAI",
        "Anthropic"
      ]
    }
  },
  "error": null,
  "timestamp": "2025-01-07T20:30:00.000Z"
}
```

## Data Types

### Cloud Providers
- `AWS` - Amazon Web Services
- `Azure` - Microsoft Azure
- `GCP` - Google Cloud Platform
- `Kubernetes` - Kubernetes clusters
- `IBM` - IBM Cloud
- `Oracle` - Oracle Cloud
- `Alibaba` - Alibaba Cloud

### AI Providers
- `OpenAI` - OpenAI GPT-4 Turbo
- `Claude3_5Sonnet` - Anthropic Claude-3.5-Sonnet
- `ClaudeCode` - Anthropic Claude for code generation

### Performance Tiers
- `Basic` - Development/testing environments
- `Standard` - Staging environments
- `Premium` - Production environments
- `Enterprise` - High-availability enterprise

### Security Levels
- `Basic` - Standard security practices
- `Enhanced` - Advanced security features
- `Maximum` - Maximum security configuration
- `Compliant` - Industry compliance standards

### Optimization Goals
- `CostReduction` - Minimize infrastructure costs
- `PerformanceImprovement` - Enhance system performance
- `Reliability` - Improve system reliability
- `Security` - Strengthen security posture
- `Sustainability` - Reduce environmental impact

## Error Handling

All endpoints return standardized error responses:

```json
{
  "success": false,
  "data": null,
  "error": "Detailed error message",
  "timestamp": "2025-01-07T20:30:00.000Z"
}
```

### Common HTTP Status Codes
- `200` - Success
- `400` - Bad Request (invalid input)
- `401` - Unauthorized (invalid token)
- `429` - Rate Limited
- `500` - Internal Server Error

## Rate Limiting

The AI API implements rate limiting to ensure fair usage:
- Infrastructure generation: 10 requests per minute
- Optimization analysis: 5 requests per minute
- Health checks: 60 requests per minute
- Capabilities: 60 requests per minute

## Environment Variables

Configure the following environment variables for AI integration:

```bash
# OpenAI Configuration
OPENAI_API_KEY=your_openai_api_key

# Anthropic Configuration
ANTHROPIC_API_KEY=your_anthropic_api_key

# Database Configuration
DATABASE_URL=postgresql://user:password@localhost:26257/sirsi_nexus?sslmode=disable
```

## Examples

### Generate AWS Infrastructure with curl

```bash
curl -X POST http://localhost:3000/api/ai/infrastructure/generate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your_jwt_token" \
  -d '{
    "description": "Web application with database",
    "cloud_provider": "AWS",
    "ai_provider": "OpenAI",
    "requirements": {
      "budget_limit": 1000.0,
      "performance_tier": "Standard",
      "security_level": "Enhanced",
      "compliance_requirements": [],
      "scaling_requirements": {
        "min_instances": 1,
        "max_instances": 5,
        "auto_scaling": true,
        "load_balancing": true
      }
    }
  }'
```

### Optimize Infrastructure with Python

```python
import requests
import json

url = "http://localhost:3000/api/ai/optimization/analyze"
headers = {
    "Content-Type": "application/json",
    "Authorization": "Bearer your_jwt_token"
}

data = {
    "infrastructure_data": {
        "cloud_provider": "AWS",
        "regions": ["us-west-2"],
        "resources": [
            {
                "resource_type": "EC2",
                "instance_type": "t3.medium",
                "count": 3,
                "utilization": 0.25,
                "cost_per_hour": 0.0416,
                "tags": {"Environment": "dev"}
            }
        ],
        "usage_patterns": {
            "cpu_utilization": [0.25, 0.23, 0.27, 0.24, 0.26],
            "memory_utilization": [0.35, 0.33, 0.37, 0.34, 0.36],
            "network_io": [500, 480, 520, 490, 510],
            "storage_io": [200, 190, 210, 195, 205],
            "time_series_data": []
        }
    },
    "performance_metrics": {
        "response_time_ms": 200.0,
        "throughput_rps": 500.0,
        "error_rate": 0.002,
        "availability": 0.999
    },
    "cost_constraints": {
        "monthly_budget": 2000.0,
        "cost_optimization_priority": "Aggressive"
    },
    "optimization_goals": ["CostReduction"],
    "ai_provider": "Claude3_5Sonnet"
}

response = requests.post(url, headers=headers, json=data)
result = response.json()

if result["success"]:
    savings = result["data"]["predicted_cost_savings"]
    print(f"Predicted annual savings: ${savings:,.2f}")
    
    for rec in result["data"]["recommendations"]:
        print(f"- {rec['description']}: ${rec['cost_savings_annual']:,.2f}")
else:
    print(f"Error: {result['error']}")
```

## Best Practices

1. **Caching**: Cache responses for similar requests to reduce API calls
2. **Monitoring**: Monitor confidence scores and adjust thresholds accordingly
3. **Validation**: Always validate generated templates before deployment
4. **Security**: Keep API keys secure and rotate them regularly
5. **Testing**: Test optimizations in staging environments first
6. **Feedback**: Provide feedback on AI recommendations for continuous improvement

## Support

For technical support or questions about the AI API:
- Documentation: `/docs/ai/`
- Health Check: `GET /ai/health`
- Capabilities: `GET /ai/capabilities`
- Issue Tracking: GitHub Issues
- Email: ai-support@sirsinexus.com
