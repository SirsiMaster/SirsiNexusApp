<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | Sirsi Portfolio</title>

    <!-- Security Initiation -->
    <script src="/assets/js/security-init.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --primary: #C8A951;
            --bg: #0f172a;
        }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Inter', sans-serif;
        }

        .font-serif {
            font-family: 'Cinzel', serif;
        }

        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-gold {
            background: var(--primary);
            color: #0f172a;
            transition: all 0.2s;
        }

        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(200, 169, 81, 0.4);
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">
    <nav class="p-6 border-b border-white/10 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-gold rounded-sm rotate-45" style="background: #C8A951;"></div>
            <span class="font-serif tracking-widest text-xl text-[#C8A951]">SIRSI</span>
        </div>
        <div class="text-[10px] uppercase tracking-widest text-white/40">Secure Transaction Engine</div>
    </nav>

    <main class="flex-grow container mx-auto max-w-4xl px-6 py-12">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-12">

            <!-- Selection Summary -->
            <div class="space-y-8">
                <div>
                    <h1 class="font-serif text-3xl mb-2 text-[#C8A951]">Checkout</h1>
                    <p class="text-white/60">Review your selected items and complete the payment agreement.</p>
                </div>

                <div id="order-summary" class="glass rounded-2xl p-6 space-y-4">
                    <h2 class="uppercase text-xs tracking-widest text-white/40 border-b border-white/10 pb-2">Order
                        Summary</h2>
                    <div id="items-list" class="space-y-4">
                        <!-- Injected via JS -->
                        <div class="animate-pulse flex justify-between">
                            <div class="h-4 bg-white/10 rounded w-1/2"></div>
                            <div class="h-4 bg-white/10 rounded w-1/4"></div>
                        </div>
                    </div>
                    <div class="border-t border-white/10 pt-4 flex justify-between items-end">
                        <span class="text-white/60">Total Amount</span>
                        <span id="total-price" class="text-2xl font-serif text-[#C8A951]">$0.00</span>
                    </div>
                </div>
            </div>

            <!-- Execution Panel -->
            <div class="glass rounded-2xl p-8 space-y-8 border-t-2 border-[#C8A951]">
                <div>
                    <h3 class="font-serif text-xl mb-4">Payment Agreement</h3>
                    <div
                        class="text-xs text-white/60 leading-relaxed bg-black/20 p-4 rounded-lg overflow-y-auto h-40 border border-white/5">
                        <p class="mb-4">This Payment Agreement ("Agreement") is entered into by and between Sirsi
                            Technologies Inc. (on behalf of its Portfolio Subsidiary) and the Customer identified below.
                        </p>
                        <p class="mb-4">1. ACQUISITION OF GOODS. Customer agrees to purchase the products/services
                            listed in the Order Summary for the total amount specified.</p>
                        <p class="mb-4">2. PAYMENT TERMS. For singular transactions, payment is due in full immediately.
                            For installments, Customer authorizes Sirsi to charge the payment method on file according
                            to the selected schedule.</p>
                        <p class="mb-4">3. ACKNOWLEDGMENT. By signing below, Customer acknowledges that this transaction
                            is governed by the Sirsi Standard Terms of Sale and is legally binding.</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="space-y-2">
                        <label class="text-[10px] uppercase tracking-widest text-white/40">Full Legal Name</label>
                        <input type="text" id="signer-name" placeholder="John Doe"
                            class="w-full bg-black/20 border border-white/10 rounded-lg p-3 text-sm focus:border-[#C8A951] outline-none">
                    </div>

                    <label class="flex items-start gap-3 cursor-pointer group">
                        <input type="checkbox" id="legal-check" class="mt-1 accent-[#C8A951]">
                        <span class="text-xs text-white/60 group-hover:text-white transition-colors">I accept the terms
                            of this Payment Agreement and authorize the secure settlement of funds.</span>
                    </label>

                    <button id="cta-btn" onclick="processCheckout()" disabled
                        class="w-full py-4 rounded-xl font-bold uppercase tracking-widest btn-gold disabled:opacity-30 disabled:cursor-not-allowed">
                        Execute & Pay
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="p-8 text-center text-[10px] text-white/20 uppercase tracking-[0.2em] border-t border-white/5">
        Secure checkout powered by Sirsi Nexus Universal Component System
    </footer>

    <script>
        // Mock Catalog Logic (In production, this imports from catalog.ts via bundle)
        const MOCK_CATALOG = {
            'vault-plus': { name: 'Vault+ Expansion', price: 2500 },
            'ai-shepherd': { name: 'The Shepherd AI', price: 5000 },
            'support-annual': { name: 'Premium Support (Annual)', price: 1200 }
        };

        let totalAmount = 0;

        function init() {
            const params = new URLSearchParams(window.location.search);
            const productIds = params.get('items')?.split(',') || [];
            const itemsContainer = document.getElementById('items-list');
            itemsContainer.innerHTML = '';

            productIds.forEach(id => {
                const product = MOCK_CATALOG[id];
                if (product) {
                    totalAmount += product.price;
                    itemsContainer.innerHTML += `
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-white/80">${product.name}</span>
                            <span class="font-mono text-[#C8A951]">$${product.price.toLocaleString()}</span>
                        </div>
                    `;
                }
            });

            if (totalAmount === 0) {
                itemsContainer.innerHTML = '<p class="text-xs text-red-400">No items selected.</p>';
            }

            document.getElementById('total-price').textContent = `$${totalAmount.toLocaleString()}`;

            // Interaction listeners
            const nameInput = document.getElementById('signer-name');
            const check = document.getElementById('legal-check');
            const btn = document.getElementById('cta-btn');

            const validate = () => {
                btn.disabled = !(nameInput.value.length > 2 && check.checked && totalAmount > 0);
            };

            nameInput.addEventListener('input', validate);
            check.addEventListener('change', validate);
        }

        async function processCheckout() {
            const btn = document.getElementById('cta-btn');
            btn.innerHTML = '<span class="animate-pulse">Orchestrating Rails...</span>';
            btn.disabled = true;

            const name = document.getElementById('signer-name').value;
            const envelopeId = `PURCHASE-${Date.now().toString(36).toUpperCase()}`;

            // 1. Audit Log (Intent)
            console.log(`[AUDIT] Purchase Intent: ${envelopeId} for $${totalAmount}`);

            // 2. Transition to Universal Payment Bridge
            setTimeout(() => {
                const payParams = new URLSearchParams({
                    envelope: envelopeId,
                    amount: totalAmount * 100, // Cents
                    client: name,
                    ref: 'PURCHASE-AGREEMENT-V1',
                    status: 'awaiting_payment'
                });
                window.location.href = `/payment.html?${payParams.toString()}`;
            }, 1000);
        }

        init();
    </script>
</body>

</html>